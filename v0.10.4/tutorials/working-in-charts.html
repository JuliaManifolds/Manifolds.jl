<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>work in charts · Manifolds.jl</title><meta name="title" content="work in charts · Manifolds.jl"/><meta property="og:title" content="work in charts · Manifolds.jl"/><meta property="twitter:title" content="work in charts · Manifolds.jl"/><meta name="description" content="Documentation for Manifolds.jl."/><meta property="og:description" content="Documentation for Manifolds.jl."/><meta property="twitter:description" content="Documentation for Manifolds.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img class="docs-light-only" src="../assets/logo.png" alt="Manifolds.jl logo"/><img class="docs-dark-only" src="../assets/logo-dark.png" alt="Manifolds.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">Manifolds.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">How to...</span><ul><li><a class="tocitem" href="getstarted.html">🚀 Get Started with <code>Manifolds.jl</code></a></li><li class="is-active"><a class="tocitem" href="working-in-charts.html">work in charts</a><ul class="internal"><li><a class="tocitem" href="#Setup"><span>Setup</span></a></li><li><a class="tocitem" href="#Values-for-the-geodesic"><span>Values for the geodesic</span></a></li></ul></li><li><a class="tocitem" href="hand-gestures.html">perform Hand gesture analysis</a></li><li><a class="tocitem" href="integration.html">integrate on manifolds and handle probability densities</a></li><li><a class="tocitem" href="exploring-curvature.html">explore curvature without coordinates</a></li><li><a class="tocitem" href="groups.html">work with groups</a></li></ul></li><li><span class="tocitem">Manifolds</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Basic manifolds</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../manifolds/centeredmatrices.html">Centered matrices</a></li><li><a class="tocitem" href="../manifolds/choleskyspace.html">Cholesky space</a></li><li><a class="tocitem" href="../manifolds/circle.html">Circle</a></li><li><a class="tocitem" href="../manifolds/elliptope.html">Elliptope</a></li><li><a class="tocitem" href="../manifolds/essentialmanifold.html">Essential manifold</a></li><li><a class="tocitem" href="../manifolds/euclidean.html">Euclidean</a></li><li><a class="tocitem" href="../manifolds/fixedrankmatrices.html">Fixed-rank matrices</a></li><li><a class="tocitem" href="../manifolds/flag.html">Flag</a></li><li><a class="tocitem" href="../manifolds/generalizedstiefel.html">Generalized Stiefel</a></li><li><a class="tocitem" href="../manifolds/generalizedgrassmann.html">Generalized Grassmann</a></li><li><a class="tocitem" href="../manifolds/grassmann.html">Grassmann</a></li><li><a class="tocitem" href="../manifolds/hamiltonian.html">Hamiltonian</a></li><li><a class="tocitem" href="../manifolds/hyperbolic.html">Hyperbolic space</a></li><li><a class="tocitem" href="../manifolds/hyperrectangle.html">Hyperrectangle</a></li><li><a class="tocitem" href="../manifolds/lorentz.html">Lorentzian manifold</a></li><li><a class="tocitem" href="../manifolds/multinomialdoublystochastic.html">Multinomial doubly stochastic matrices</a></li><li><a class="tocitem" href="../manifolds/multinomial.html">Multinomial matrices</a></li><li><a class="tocitem" href="../manifolds/multinomialsymmetric.html">Multinomial symmetric matrices</a></li><li><a class="tocitem" href="../manifolds/multinomialsymmetricpositivedefinite.html">Multinomial symmetric positive definite matrices</a></li><li><a class="tocitem" href="../manifolds/oblique.html">Oblique manifold</a></li><li><a class="tocitem" href="../manifolds/probabilitysimplex.html">Probability simplex</a></li><li><a class="tocitem" href="../manifolds/positivenumbers.html">Positive numbers</a></li><li><a class="tocitem" href="../manifolds/projectivespace.html">Projective space</a></li><li><a class="tocitem" href="../manifolds/generalunitary.html">Orthogonal and Unitary Matrices</a></li><li><a class="tocitem" href="../manifolds/rotations.html">Rotations</a></li><li><a class="tocitem" href="../manifolds/shapespace.html">Shape spaces</a></li><li><a class="tocitem" href="../manifolds/skewhermitian.html">Skew-Hermitian matrices</a></li><li><a class="tocitem" href="../manifolds/spectrahedron.html">Spectrahedron</a></li><li><a class="tocitem" href="../manifolds/sphere.html">Sphere</a></li><li><a class="tocitem" href="../manifolds/stiefel.html">Stiefel</a></li><li><a class="tocitem" href="../manifolds/symmetric.html">Symmetric matrices</a></li><li><a class="tocitem" href="../manifolds/symmetricpositivedefinite.html">Symmetric positive definite</a></li><li><a class="tocitem" href="../manifolds/spdfixeddeterminant.html">SPD, fixed determinant</a></li><li><a class="tocitem" href="../manifolds/symmetricpsdfixedrank.html">Symmetric positive semidefinite fixed rank</a></li><li><a class="tocitem" href="../manifolds/symplecticgrassmann.html">Symplectic Grassmann</a></li><li><a class="tocitem" href="../manifolds/symplectic.html">Symplectic matrices</a></li><li><a class="tocitem" href="../manifolds/symplecticstiefel.html">Symplectic Stiefel</a></li><li><a class="tocitem" href="../manifolds/torus.html">Torus</a></li><li><a class="tocitem" href="../manifolds/tucker.html">Tucker</a></li><li><a class="tocitem" href="../manifolds/spheresymmetricmatrices.html">Unit-norm symmetric matrices</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Combined manifolds</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../manifolds/fiber_bundle.html">Fiber bundle</a></li><li><a class="tocitem" href="../manifolds/graph.html">Graph manifold</a></li><li><a class="tocitem" href="../manifolds/power.html">Power manifold</a></li><li><a class="tocitem" href="../manifolds/product.html">Product manifold</a></li><li><a class="tocitem" href="../manifolds/vector_bundle.html">Vector bundle</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Manifold decorators</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../manifolds/connection.html">Connection manifold</a></li><li><a class="tocitem" href="../manifolds/group.html">Group manifold</a></li><li><a class="tocitem" href="../manifolds/metric.html">Metric manifold</a></li><li><a class="tocitem" href="../manifolds/quotient.html">Quotient manifold</a></li></ul></li></ul></li><li><span class="tocitem">Features on Manifolds</span><ul><li><a class="tocitem" href="../features/atlases.html">Atlases and charts</a></li><li><a class="tocitem" href="../features/differentiation.html">Differentiation</a></li><li><a class="tocitem" href="../features/distributions.html">Distributions</a></li><li><a class="tocitem" href="../features/group_actions.html">Group actions</a></li><li><a class="tocitem" href="../features/integration.html">Integration</a></li><li><a class="tocitem" href="../features/statistics.html">Statistics</a></li><li><a class="tocitem" href="../features/testing.html">Testing</a></li><li><a class="tocitem" href="../features/utilities.html">Utilities</a></li></ul></li><li><span class="tocitem">Miscellanea</span><ul><li><a class="tocitem" href="../misc/about.html">About</a></li><li><a class="tocitem" href="../misc/NEWS.html">Changelog</a></li><li><a class="tocitem" href="../misc/CONTRIBUTING.html">Contributing</a></li><li><a class="tocitem" href="../misc/internals.html">Internals</a></li><li><a class="tocitem" href="../misc/notation.html">Notation</a></li><li><a class="tocitem" href="../misc/references.html">References</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How to...</a></li><li class="is-active"><a href="working-in-charts.html">work in charts</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="working-in-charts.html">work in charts</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaManifolds/Manifolds.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaManifolds/Manifolds.jl/blob/master/docs/src/tutorials/working-in-charts.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Working-in-charts"><a class="docs-heading-anchor" href="#Working-in-charts">Working in charts</a><a id="Working-in-charts-1"></a><a class="docs-heading-anchor-permalink" href="#Working-in-charts" title="Permalink"></a></h1><p>In this tutorial we will learn how to use charts for basic geometric operations like exponential map, logarithmic map and parallel transport.</p><p>There are two conceptually different approaches to working on a manifold: working in charts and chart-free representations.</p><p>The first one, widespread in differential geometry textbooks, is based on defining an atlas on the manifold and performing computations in selected charts. This approach, while generic, is not ideally suitable in all circumstances. For example, working in charts that do not cover the entire manifold causes issues with having to switch charts when operating on a manifold.</p><p>The second one is beneficial if there exists a representation of points and tangent vectors for a manifold which allows for efficient closed-form formulas for standard functions like the exponential map or Riemannian distance in this representation. These computations are then chart-free. <code>Manifolds.jl</code> supports both approaches, although the chart-free approach is the main focus of the library.</p><p>In this tutorial we focus on chart-based computation.</p><pre><code class="language-julia hljs">using Manifolds, RecursiveArrayTools, OrdinaryDiffEq, DiffEqCallbacks, BoundaryValueDiffEq</code></pre><p>The manifold we consider is the <code>M</code> is the torus in form of the <a href="https://juliamanifolds.github.io/Manifolds.jl/latest/manifolds/torus.html#Manifolds.EmbeddedTorus"><code>EmbeddedTorus</code></a>, that is the representation defined as a surface of revolution of a circle of radius 2 around a circle of radius 3. The atlas we will perform computations in is its <a href="https://juliamanifolds.github.io/Manifolds.jl/latest/manifolds/torus.html#Manifolds.DefaultTorusAtlas"><code>DefaultTorusAtlas</code></a> <code>A</code>, consisting of a family of charts indexed by two angles, that specify the base point of the chart.</p><p>We will draw geodesics time between <code>0</code> and <code>t_end</code>, and then sample the solution at multiples of <code>dt</code> and draw a line connecting sampled points.</p><pre><code class="language-julia hljs">M = Manifolds.EmbeddedTorus(3, 2)
A = Manifolds.DefaultTorusAtlas()</code></pre><pre><code class="nohighlight hljs">Manifolds.DefaultTorusAtlas()</code></pre><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><p>We will first set up our plot with an empty torus. <code>param_points</code> are points on the surface of the torus that will be used for basic surface shape in <code>Makie.jl</code>. The torus will be colored according to its Gaussian curvature stored in <code>gcs</code>. We later want to have a color scale that has negative curvature blue, zero curvature white and positive curvature red so <code>gcs_mm</code> is the largest absolute value of the curvature that will be needed to properly set range of curvature values.</p><p>In the documentation this tutorial represents a static situation (without interactivity). <code>Makie.jl</code> rendering is turned off.</p><pre><code class="language-julia hljs"># using GLMakie, Makie
# GLMakie.activate!()

&quot;&quot;&quot;
    torus_figure()

This function generates a simple plot of a torus and returns the new figure containing the plot.
&quot;&quot;&quot;
function torus_figure()
    fig = Figure(resolution=(1400, 1000), fontsize=16)
    ax = LScene(fig[1, 1], show_axis=true)
    ϴs, φs = LinRange(-π, π, 50), LinRange(-π, π, 50)
    param_points = [Manifolds._torus_param(M, θ, φ) for θ in ϴs, φ in φs]
    X1, Y1, Z1 = [[p[i] for p in param_points] for i in 1:3]
    gcs = [gaussian_curvature(M, p) for p in param_points]
    gcs_mm = max(abs(minimum(gcs)), abs(maximum(gcs)))
    pltobj = surface!(
        ax,
        X1,
        Y1,
        Z1;
        shading=true,
        ambient=Vec3f(0.65, 0.65, 0.65),
        backlight=1.0f0,
        color=gcs,
        colormap=Reverse(:RdBu),
        colorrange=(-gcs_mm, gcs_mm),
        transparency=true,
    )
    wireframe!(ax, X1, Y1, Z1; transparency=true, color=:gray, linewidth=0.5)
    zoom!(ax.scene, cameracontrols(ax.scene), 0.98)
    Colorbar(fig[1, 2], pltobj, height=Relative(0.5), label=&quot;Gaussian curvature&quot;)
    return ax, fig
end</code></pre><pre><code class="nohighlight hljs">torus_figure</code></pre><h2 id="Values-for-the-geodesic"><a class="docs-heading-anchor" href="#Values-for-the-geodesic">Values for the geodesic</a><a id="Values-for-the-geodesic-1"></a><a class="docs-heading-anchor-permalink" href="#Values-for-the-geodesic" title="Permalink"></a></h2><p><code>solve_for</code> is a helper function that solves a parallel transport along geodesic problem on the torus <code>M</code>. <code>p0x</code> is the <span>$(\theta, \varphi)$</span> parametrization of the point from which we will transport the vector. We first calculate the coordinates in the embedding of <code>p0x</code> and store it as <code>p</code>, and then get the initial chart from atlas <code>A</code> appropriate for starting working at point <code>p</code>. The vector we transport has coordinates <code>Y_transp</code> in the induced tangent space basis of chart <code>i_p0x</code>. The function returns the full solution to the parallel transport problem, containing the sequence of charts that was used and solutions of differential equations computed using <code>OrdinaryDiffEq</code>.</p><p><code>bvp_i</code> is needed later for a different purpose, it is the chart index we will use for solving the logarithmic map boundary value problem in.</p><p>Next we solve the vector transport problem <code>solve_for([θₚ, φₚ], [θₓ, φₓ], [θy, φy])</code>, sample the result at the selected time steps and store the result in <code>geo</code>. The solution includes the geodesic which we extract and convert to a sequence of points digestible by <code>Makie.jl</code>, <code>geo_ps</code>. <code>[θₚ, φₚ]</code> is the parametrization in chart (0, 0) of the starting point of the geodesic. The direction of the geodesic is determined by <code>[θₓ, φₓ]</code>, coordinates of the tangent vector at the starting point expressed in the induced basis of chart <code>i_p0x</code> (which depends on the initial point). Finally, <code>[θy, φy]</code> are the coordinates of the tangent vector that will be transported along the geodesic, which are also expressed in same basis as <code>[θₓ, φₓ]</code>.</p><p>We won’t draw the transported vector at every point as there would be too many arrows, which is why we select every 100th point only for that purpose with <code>pt_indices</code>. Then, <code>geo_ps_pt</code> contains points at which the transported vector is tangent to and <code>geo_Ys</code> the transported vector at that point, represented in the embedding.</p><p>The logarithmic map will be solved between points with parametrization <code>bvp_a1</code> and <code>bvp_a2</code> in chart <code>bvp_i</code>. The result is assigned to variable <code>bvp_sol</code> and then sampled with time step 0.05. The result of this sampling is converted from parameters in chart <code>bvp_i</code> to point in the embedding and stored in <code>geo_r</code>.</p><pre><code class="language-julia hljs">function solve_for(p0x, X_p0x, Y_transp, T)
    p = [Manifolds._torus_param(M, p0x...)...]
    i_p0x = Manifolds.get_chart_index(M, A, p)
    p_exp = Manifolds.solve_chart_parallel_transport_ode(
        M,
        [0.0, 0.0],
        X_p0x,
        A,
        i_p0x,
        Y_transp;
        final_time=T,
    )
    return p_exp
end;</code></pre><h3 id="Solving-parallel-Transport-ODE"><a class="docs-heading-anchor" href="#Solving-parallel-Transport-ODE">Solving parallel Transport ODE</a><a id="Solving-parallel-Transport-ODE-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-parallel-Transport-ODE" title="Permalink"></a></h3><p>We set the end time <code>t_end</code> and time step <code>dt</code>.</p><pre><code class="language-julia hljs">t_end = 2.0
dt = 1e-1</code></pre><pre><code class="nohighlight hljs">0.1</code></pre><p>We also parametrise the start point and direction.</p><pre><code class="language-julia hljs">θₚ = π/10
φₚ = -π/4
θₓ = π/2
φₓ = 0.7
θy = 0.2
φy = -0.1

geo = solve_for([θₚ, φₚ], [θₓ, φₓ], [θy, φy], t_end)(0.0:dt:t_end);
# geo_ps = [Point3f(s[1]) for s in geo]
# pt_indices = 1:div(length(geo), 10):length(geo)
# geo_ps_pt = [Point3f(s[1]) for s in geo[pt_indices]]
# geo_Ys = [Point3f(s[3]) for s in geo[pt_indices]]

# ax1, fig1 = torus_figure()
# arrows!(ax1, geo_ps_pt, geo_Ys, linewidth=0.05, color=:blue)
# lines!(geo_ps; linewidth=4.0, color=:green)
# fig1</code></pre><p><img src="working-in-charts/working-in-charts-transport.png" alt="fig-pt"/></p><p>fig-pt</p><h3 id="Solving-the-logarithmic-map-ODE"><a class="docs-heading-anchor" href="#Solving-the-logarithmic-map-ODE">Solving the logarithmic map ODE</a><a id="Solving-the-logarithmic-map-ODE-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-logarithmic-map-ODE" title="Permalink"></a></h3><pre><code class="language-julia hljs">θ₁=π/2
φ₁=-1.0
θ₂=-π/8
φ₂=π/2

bvp_i = (0, 0)
bvp_a1 = [θ₁, φ₁]
bvp_a2 = [θ₂, φ₂]
bvp_sol = Manifolds.solve_chart_log_bvp(M, bvp_a1, bvp_a2, A, bvp_i);
# geo_r = [Point3f(get_point(M, A, bvp_i, p[1:2])) for p in bvp_sol(0.0:0.05:1.0)]

# ax2, fig2 = torus_figure()
# lines!(geo_r; linewidth=4.0, color=:green)
# fig2</code></pre><p><img src="working-in-charts/working-in-charts-geodesic.png" alt="fig-geodesic"/></p><p>fig-geodesic</p><p>An interactive Pluto version of this tutorial is available in file <a href="https://github.com/JuliaManifolds/Manifolds.jl/blob/616855447996fb1ee7dfb2a779341b962a1323f8/tutorials/working-in-charts.jl"><code>tutorials/working-in-charts.jl</code></a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="getstarted.html">« 🚀 Get Started with <code>Manifolds.jl</code></a><a class="docs-footer-nextpage" href="hand-gestures.html">perform Hand gesture analysis »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 21 October 2024 13:47">Monday 21 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
