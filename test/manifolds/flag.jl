using Manifolds
using Test

@testset "Flag manifold" begin
    M = Flag(5, 1, 2)

    p1_ortho = Manifolds.OrthogonalPoint(
        [
            0.5483710839601286 0.11431583140179802 -0.4549972669468796 -0.24420811180644114 -0.6477352315306864
            -0.14598104021651825 -0.3863352173686217 -0.7998129702578309 -0.12512220381981268 0.41722689562953885
            -0.27361606694009666 -0.0062486771708479966 -0.269431859703507 0.8487540190060319 -0.36348079748958584
            -0.5860445034111339 0.7091711045363329 -0.2369412411721794 -0.29834711991839624 -0.09206535059673804
            -0.5095731332277309 -0.5785449758108591 0.1566589317170019 -0.3395768594835529 -0.5155254295115427
        ],
    )
    p2_ortho = Manifolds.OrthogonalPoint(
        [
            0.6899566465726515 -0.09915024703518771 -0.6226523787333554 0.3430242785649697 -0.09363446980550538
            -0.11411076737780768 0.674849625290569 0.09305040872989712 0.4360207581932596 -0.5768745408435015
            0.17343507284015292 -0.4980917752801034 0.24595262802592188 -0.2569777450904701 -0.7715533696398492
            0.6921672300039265 0.30834121120497526 0.6003132332813077 -0.1586226925653731 0.20073137904172766
            0.041992378311914824 0.43769566210896327 -0.4275242255210552 -0.7752557788698422 -0.15119742542861503
        ],
    )

    X1_ortho = Manifolds.OrthogonalTVector(
        [
            0.0 -0.4015327292726182 0.780864290667572 0.4338924112653854 -1.7532409316999389
            0.4015327292726182 0.0 -0.03497663360767567 -0.13649144092765172 -0.6576516594131526
            -0.780864290667572 0.03497663360767567 0.0 0.0 0.0
            -0.4338924112653854 0.13649144092765172 0.0 0.0 0.0
            1.7532409316999389 0.6576516594131526 0.0 0.0 0.0
        ],
    )
    X2_ortho = Manifolds.OrthogonalTVector(
        [
            0.0 -0.2979953307015468 0.7855622797662635 -1.783621666926397 -0.7481810438379631
            0.2979953307015468 0.0 -0.10452766698617191 -0.018998219248410615 -0.014502786096688508
            -0.7855622797662635 0.10452766698617191 0.0 0.0 0.0
            1.783621666926397 0.018998219248410615 0.0 0.0 0.0
            0.7481810438379631 0.014502786096688508 0.0 0.0 0.0
        ],
    )

    X2_ortho_wrong1 = Manifolds.OrthogonalTVector(
        [
            0.0 -0.1979953307015468 0.7855622797662635 -1.783621666926397 -0.7481810438379631
            0.3979953307015468 0.0 -0.10452766698617191 -0.018998219248410615 -0.014502786096688508
            -0.7855622797662635 0.10452766698617191 0.0 0.0 0.0
            1.783621666926397 0.018998219248410615 0.0 0.0 0.0
            0.7481810438379631 0.014502786096688508 0.0 0.0 0.0
        ],
    )

    @test check_point(M, p1_ortho) === nothing
    @test check_vector(M, p1_ortho, X1_ortho) === nothing
    @test check_vector(M, p1_ortho, X2_ortho_wrong1) isa DomainError
    @test isapprox(M, p1_ortho, X2_ortho, project(M, p1_ortho, X2_ortho_wrong1))
end
